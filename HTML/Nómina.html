<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Gesti√≥n de Empleados - ERP AbogaTech</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../CSS/empleados.css" />
  <style>
  body {
    display: flex;
    font-family: 'Inter', sans-serif;
    margin: 0;
    background-color: #f8f8f8;
  }

  .sidebar {
    width: 220px;
    background-color: #0d0d22;
    color: white;
    padding: 20px;
    min-height: 100vh;
  }

  .sidebar h2 {
    color: #FFD700;
  }

  .sidebar ul {
    list-style: none;
    padding: 0;
  }

  .sidebar li {
    padding: 10px;
    cursor: pointer;
  }

  .sidebar li:hover {
    background-color: #1e1e3f;
  }

  .main {
    flex-grow: 1;
    padding: 40px;
  }

  .formulario label {
    display: block;
    margin-top: 10px;
  }

  .formulario input,
  .formulario select,
  .formulario button {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 6px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }

  .formulario button {
    background-color: #FFD700;
    color: black;
    font-weight: bold;
    margin-top: 15px;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  .formulario button:hover {
    background-color: #e6c200;
  }

  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 10px;
    margin-top: 20px;
    font-size: 14px;
  }

  th {
    background-color: #0d0d22;
    color: white;
    text-align: left;
    padding: 12px;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
  }

  td {
    background-color: white;
    padding: 12px;
    border-bottom: 1px solid #ddd;
    border-left: 1px solid #eee;
    border-right: 1px solid #eee;
  }

  tr {
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    margin-bottom: 10px;
  }

  tr:last-child td {
    border-bottom: 1px solid #ddd;
  }

  td input,
  td select {
    width: 100%;
    padding: 6px;
    border: 1px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
    font-family: 'Inter', sans-serif;
  }

  td input[type="date"] {
    padding: 6px;
  }

  .btn-update {
    background-color: #4CAF50;
    color: white;
    margin-right: 5px;
    border: none;
    padding: 6px 10px;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.3s;
  }

  .btn-update:hover {
    background-color: #45a049;
  }

  .btn-delete {
    background-color: #f44336;
    color: white;
    border: none;
    padding: 6px 10px;
    cursor: pointer;
    border-radius: 4px;
    transition: background-color 0.3s;
  }

  .btn-delete:hover {
    background-color: #d32f2f;
  }


  table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0 10px;
  margin-top: 20px;
  font-size: 14px;
}

th {
  background-color: #0d0d22;
  color: white;
  text-align: left;
  padding: 12px;
  border-top-left-radius: 8px;
  border-top-right-radius: 8px;
}

td {
  background-color: white;
  padding: 12px;
  border-bottom: 1px solid #ddd;
  vertical-align: middle;
}

tr {
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
}

td input,
td select {
  width: 100%;
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 6px;
  box-sizing: border-box;
  font-family: 'Inter', sans-serif;
  font-size: 14px;
}

.btn-update {
  background-color: #FFD700;
  color: black;
  font-weight: bold;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  margin-right: 5px;
  transition: background-color 0.3s ease;
}

.btn-update:hover {
  background-color: #e6c200;
}

.btn-delete {
  background-color: #f44336;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.btn-delete:hover {
  background-color: #d32f2f;
}

</style>

</head>

<body>
  <div class="sidebar">
    <h2>üßë‚Äç‚öñÔ∏è ERP M√ìDULO RRHH/N√ìMINA</h2>
    <ul>
      <li onclick="mostrarInicio()">üè† Inicio</li>
      <li onclick="mostrarFormulario()">üìù Crear Empleado</li>
      <li onclick="cargarEmpleados()">üìã Consultar Empleados</li>
      <li onclick="mostrarNomina()">üí∞ Calcular N√≥mina</li>
      <li onclick="volverAlPanel()">‚Ü©Ô∏è Volver al Panel</li>
    </ul>
  </div>
  <div class="main" id="contenido">
    <h2>M√≥dulo Empleados - ERP AbogaTech</h2>
    <p>Usa el men√∫ lateral para gestionar a los empleados del bufete.</p>
  </div>

  <script>
    function mostrarInicio() {
      document.getElementById('contenido').innerHTML = `
        <h2>M√≥dulo Empleados - ERP AbogaTech</h2>
        <p>Usa el men√∫ lateral para gestionar a los empleados del bufete.</p>
      `;
    }

    function volverAlPanel() {
      window.location.href = '../HTML/M√≥dulos.html';
    }

    function mostrarFormulario() {
      document.getElementById('contenido').innerHTML = `
        <h2>Registrar Nuevo Abogado</h2>
        <form id="formAbogado" class="formulario">
          <label>Nombre:</label>
          <input type="text" id="nombre" required />
          
          <label>Especialidad:</label>
          <select id="especialidad" required>
            <option value="">Selecciona una opci√≥n</option>
            <option value="Asesor√≠a Jur√≠dica en Siniestros Viales">Asesor√≠a Jur√≠dica en Siniestros Viales</option>
            <option value="Implementaci√≥n y Manejo del PESV">Implementaci√≥n y Manejo del PESV</option>
            <option value="Reconstrucci√≥n T√©cnica y Anal√≠tica de Siniestros Viales">Reconstrucci√≥n T√©cnica y Anal√≠tica de Siniestros Viales</option>
            <option value="Servicios Funerarios en Siniestros Viales">Servicios Funerarios en Siniestros Viales</option>
            <option value="Reclamaciones Ante las Aseguradoras">Reclamaciones Ante las Aseguradoras</option>
          </select>
          
          <label>Tel√©fono:</label>
          <input type="text" id="telefono" required />
          <label>Correo:</label>
          <input type="email" id="correo" required />
          <label>Fecha de Contrataci√≥n:</label>
          <input type="date" id="fecha" required />
          <button type="submit">Guardar</button>
        </form>
      `;

      document.getElementById('formAbogado').onsubmit = (e) => {
        e.preventDefault();
        const datos = new URLSearchParams();
        datos.append('nombre', document.getElementById('nombre').value);
        datos.append('especialidad', document.getElementById('especialidad').value);
        datos.append('telefono', document.getElementById('telefono').value);
        datos.append('correo', document.getElementById('correo').value);
        datos.append('fecha', document.getElementById('fecha').value);

        fetch('../PHP_EMPLEADOS/crear_abogado.php', {
          method: 'POST',
          body: datos
        })
          .then(res => res.text())
          .then(msg => {
            alert(msg);
            cargarEmpleados();
          });
      };
    }

    function cargarEmpleados() {
      fetch('../PHP_Empleados/consultar_abogado.php')  // <-- Aseg√∫rate de que esta ruta exista
        .then(response => response.json())
        .then(abogados => {
          let html = '<h2>Lista de Abogados</h2>';
          if (abogados.length === 0) {
            html += '<p>No hay abogados registrados.</p>';
          } else {
            html += '<table><tr><th>ID</th><th>Nombre</th><th>Especialidad</th><th>Tel√©fono</th><th>Correo</th><th>Fecha Contrataci√≥n</th><th>Acciones</th></tr>';
            abogados.forEach(a => {
              html += `
                        <tr>
                            <td>${a.id}</td>
                            <td><input value="${a.nombre}" id="nombre-${a.id}"></td>
                            <td>
  <select id="especialidad-${a.id}">
    <option value="Asesor√≠a Jur√≠dica en Siniestros Viales" ${a.especialidad === "Asesor√≠a Jur√≠dica en Siniestros Viales" ? 'selected' : ''}>Asesor√≠a Jur√≠dica en Siniestros Viales</option>
    <option value="Implementaci√≥n y Manejo del PESV" ${a.especialidad === "Implementaci√≥n y Manejo del PESV" ? 'selected' : ''}>Implementaci√≥n y Manejo del PESV</option>
    <option value="Reconstrucci√≥n T√©cnica y Anal√≠tica de Siniestros Viales" ${a.especialidad === "Reconstrucci√≥n T√©cnica y Anal√≠tica de Siniestros Viales" ? 'selected' : ''}>Reconstrucci√≥n T√©cnica y Anal√≠tica de Siniestros Viales</option>
    <option value="Servicios Funerarios en Siniestros Viales" ${a.especialidad === "Servicios Funerarios en Siniestros Viales" ? 'selected' : ''}>Servicios Funerarios en Siniestros Viales</option>
    <option value="Reclamaciones Ante las Aseguradoras" ${a.especialidad === "Reclamaciones Ante las Aseguradoras" ? 'selected' : ''}>Reclamaciones Ante las Aseguradoras</option>
  </select>
</td>
                            <td><input value="${a.telefono}" id="telefono-${a.id}"></td>
                            <td><input value="${a.correo}" id="correo-${a.id}"></td>
                            <td><input type="date" value="${a.fecha_contratacion}" id="fecha-${a.id}"></td>
                            <td>
                                <button class="btn-update" onclick="actualizarAbogado(${a.id})">Actualizar</button>
                                <button class="btn-delete" onclick="eliminarAbogado(${a.id})">Eliminar</button>
                            </td>
                        </tr>
                    `;
            });
            html += '</table>';
          }
          document.getElementById('contenido').innerHTML = html;
        })
        .catch(err => {
          document.getElementById('contenido').innerHTML = `<p style="color:red;">Error: ${err.message}</p>`;
        });
    }



    function actualizarAbogado(id) {
      const datos = new URLSearchParams();
      datos.append('id', id);
      datos.append('nombre', document.getElementById(`nombre-${id}`).value);
      datos.append('especialidad', document.getElementById(`especialidad-${id}`).value);
      datos.append('telefono', document.getElementById(`telefono-${id}`).value);
      datos.append('correo', document.getElementById(`correo-${id}`).value);
      datos.append('fecha', document.getElementById(`fecha-${id}`).value);

      fetch('../PHP_EMPLEADOS/actualizar_abogado.php', {
        method: 'POST',
        body: datos
      })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
          cargarEmpleados();
        });
    }

    function eliminarAbogado(id) {
      if (!confirm("¬øEliminar este abogado?")) return;

      const datos = new URLSearchParams();
      datos.append('id', id);

      fetch('../PHP_EMPLEADOS/eliminar_abogado.php', {
        method: 'POST',
        body: datos
      })
        .then(res => res.text())
        .then(msg => {
          alert(msg);
          cargarEmpleados();
        });
    }

    function mostrarNomina() {
  document.getElementById('contenido').innerHTML = `
    <h2>Calcular N√≥mina</h2>
    <form id="formNomina" class="formulario">
      <label>ID Abogado:</label>
      <div style="display: flex; gap: 8px; align-items: center;">
        <input type="number" id="abogado_id" required style="flex-grow: 1;" />
        <button type="button" id="btnBuscarNombre" style="width: 100px; padding: 6px;">Buscar</button>
      </div>

      <label>Nombre:</label>
      <input type="text" id="nombre" readonly />

      <label>Salario Base:</label>
      <input type="number" id="salario_base" step="0.01" required />

      <label>Bonificaciones:</label>
      <input type="number" id="bonificaciones" step="0.01" />

      <label>Descuentos:</label>
      <input type="number" id="descuentos" step="0.01" />

      <button type="submit">Calcular y Guardar</button>
    </form>
  `;

  document.getElementById('btnBuscarNombre').addEventListener('click', () => {
    const abogadoId = document.getElementById('abogado_id').value.trim();
    if (!abogadoId) {
      alert('Por favor ingresa el ID del abogado.');
      return;
    }

    fetch(`../PHP_EMPLEADOS/busca_abogado.php?id=${abogadoId}`)
      .then(res => res.json())
      .then(data => {
        if (data.nombre) {
          document.getElementById('nombre').value = data.nombre;
        } else {
          alert('No se encontr√≥ ning√∫n abogado con ese ID.');
          document.getElementById('nombre').value = '';
        }
      })
      .catch(err => {
        alert('Error al buscar el nombre del abogado.');
        console.error(err);
      });
  });

  document.getElementById('formNomina').onsubmit = (e) => {
    e.preventDefault();
    const datos = new URLSearchParams();
    datos.append('abogado_id', document.getElementById('abogado_id').value);
    datos.append('nombre', document.getElementById('nombre').value);
    datos.append('salario_base', document.getElementById('salario_base').value);
    datos.append('bonificaciones', document.getElementById('bonificaciones').value || 0);
    datos.append('descuentos', document.getElementById('descuentos').value || 0);

    fetch('../PHP_EMPLEADOS/procesar_nomina.php', {
      method: 'POST',
      body: datos
    })
      .then(res => res.text())
      .then(msg => {
        alert(msg);
      });
  };
}




  </script>
</body>

</html>